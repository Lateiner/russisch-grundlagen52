<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Russisch-Trainer: Matching Nomen & Partizip</title>
    <!-- Polyfill für Touch-Geräte -->
    <script src="https://cdn.jsdelivr.net/npm/drag-drop-touch@1.3.1/DragDropTouch.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --error: #e74c3c;
            --bg: #f4f7f9;
            --card: #ffffff;
            --text: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--card);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        h1, h2 {
            color: var(--primary);
            text-align: center;
            border-bottom: 3px solid var(--secondary);
            padding-bottom: 10px;
        }

        .instruction {
            background: #e8f4fd;
            padding: 15px;
            border-left: 6px solid var(--secondary);
            border-radius: 4px;
            margin-bottom: 30px;
        }

        .matching-set {
            margin-bottom: 50px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background: #fff;
        }

        .matching-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .column-header {
            text-align: center;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .match-item {
            padding: 12px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            user-select: none;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }

        .match-item:hover {
            border-color: var(--secondary);
            background: #eef7ff;
        }

        .match-item.selected {
            border-color: var(--secondary);
            background: #d1ecf1;
            transform: scale(1.02);
        }

        .match-item.wrong {
            background-color: var(--error);
            border-color: var(--error);
            color: white;
        }

        /* Lösung-Farben für Paare */
        .color-0 { background-color: #d1ecf1 !important; border-color: #17a2b8 !important; color: #0c5460 !important; }
        .color-1 { background-color: #d4edda !important; border-color: #28a745 !important; color: #155724 !important; }
        .color-2 { background-color: #fff3cd !important; border-color: #ffc107 !important; color: #856404 !important; }
        .color-3 { background-color: #f8d7da !important; border-color: #dc3545 !important; color: #721c24 !important; }
        .color-4 { background-color: #e2e3e5 !important; border-color: #6c757d !important; color: #383d41 !important; }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        .btn-reset { background: #95a5a6; color: white; }
        .btn-solution { background: var(--primary); color: white; }

        @media (max-width: 600px) {
            .matching-grid { grid-template-columns: 1fr; }
            .container { padding: 15px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Matching: Nomen & Partizip</h1>
    
    <div class="instruction">
        <strong>Anleitung:</strong> Verbinde die Paare. Klicke zuerst auf ein <strong>Nomen</strong> links und dann auf das passende <strong>Partizip</strong> rechts. 
        <br><small>Bei „Lösung“ werden zusammengehörige Paare in der gleichen Farbe markiert.</small>
    </div>

    <div id="game-container">
        <!-- JS generiert hier die Sets -->
    </div>
</div>

<script>
    const allSets = [
        {
            title: "Set 1: Grundformen",
            pairs: [
                { l: "врач (m, Nom)", r: "лечивший" },
                { l: "девочка (f, Nom)", r: "читавшая" },
                { l: "письмо (n, Nom)", r: "пришедшее" },
                { l: "студенты (pl, Nom)", r: "изучавшие" },
                { l: "врача (m, Gen)", r: "лечившего" }
            ]
        },
        {
            title: "Set 2: Dativ & Akkusativ",
            pairs: [
                { l: "врачу (m, Dat)", r: "лечившему" },
                { l: "девочку (f, Akk)", r: "читавшую" },
                { l: "студентам (pl, Dat)", r: "изучавшим" },
                { l: "письма (pl, Akk)", r: "пришедшие" },
                { l: "девочке (f, Dat)", r: "читавшей" }
            ]
        },
        {
            title: "Set 3: Instrumental & Präpositional",
            pairs: [
                { l: "врачом (m, Instr)", r: "лечившим" },
                { l: "девочкой (f, Instr)", r: "читавшей" },
                { l: "студентах (pl, Pröp)", r: "изучавших" },
                { l: "письмом (n, Instr)", r: "пришедшим" },
                { l: "враче (m, Pröp)", r: "лечившем" }
            ]
        },
        {
            title: "Set 4: Gemischt & Reflexiv",
            pairs: [
                { l: "мужчинам (pl, Dat)", r: "работавшим" },
                { l: "окна (pl, Nom)", r: "разбившиеся" },
                { l: "мальчиком (m, Instr)", r: "бежавшим" },
                { l: "людей (pl, Gen)", r: "живших" },
                { l: "собаку (f, Akk)", r: "спавшую" }
            ]
        }
    ];

    let selectedLeft = null;
    let selectedRight = null;

    function renderGames() {
        const container = document.getElementById('game-container');
        allSets.forEach((set, setIdx) => {
            const section = document.createElement('div');
            section.className = 'matching-set';
            section.id = `set-${setIdx}`;

            const shuffledRight = [...set.pairs]
                .map((p, i) => ({ ...p, origIdx: i }))
                .sort(() => Math.random() - 0.5);

            section.innerHTML = `
                <h2>${set.title}</h2>
                <div class="matching-grid">
                    <div class="column" id="left-${setIdx}">
                        <div class="column-header">Nomen</div>
                        ${set.pairs.map((p, pIdx) => `<div class="match-item" data-type="left" data-pair="${pIdx}" onclick="handleSelection(this, ${setIdx})">${p.l}</div>`).join('')}
                    </div>
                    <div class="column" id="right-${setIdx}">
                        <div class="column-header">Partizip</div>
                        ${shuffledRight.map((p) => `<div class="match-item" data-type="right" data-pair="${p.origIdx}" onclick="handleSelection(this, ${setIdx})">${p.r}</div>`).join('')}
                    </div>
                </div>
                <div class="btn-group">
                    <button class="action-btn btn-reset" onclick="resetSet(${setIdx})">Reset</button>
                    <button class="action-btn btn-solution" onclick="showSetSolution(${setIdx})">Lösung</button>
                </div>
            `;
            container.appendChild(section);
        });
    }

    window.handleSelection = function(el, setIdx) {
        if (el.classList.contains('matched')) return;

        const type = el.dataset.type;
        const setEl = document.getElementById(`set-${setIdx}`);

        // Auswahl in der Spalte bereinigen
        setEl.querySelectorAll(`.column[id^="${type}"] .match-item`).forEach(item => {
            if(!item.classList.contains('matched')) {
                item.classList.remove('selected', 'wrong');
            }
        });

        el.classList.add('selected');

        if (type === 'left') selectedLeft = el;
        else selectedRight = el;

        if (selectedLeft && selectedRight) {
            checkMatch(setIdx);
        }
    }

    function checkMatch(setIdx) {
        const l = selectedLeft;
        const r = selectedRight;
        const pairIdx = l.dataset.pair;

        if (pairIdx === r.dataset.pair) {
            // Richtig: Weise die spezifische Farbe des Paares zu
            l.classList.add('matched', `color-${pairIdx}`);
            r.classList.add('matched', `color-${pairIdx}`);
            l.classList.remove('selected');
            r.classList.remove('selected');
        } else {
            // Falsch
            l.classList.add('wrong');
            r.classList.add('wrong');
            setTimeout(() => {
                l.classList.remove('wrong', 'selected');
                r.classList.remove('wrong', 'selected');
            }, 500);
        }
        selectedLeft = null;
        selectedRight = null;
    }

    window.resetSet = function(setIdx) {
        const setEl = document.getElementById(`set-${setIdx}`);
        setEl.querySelectorAll('.match-item').forEach(item => {
            item.className = 'match-item';
        });
        selectedLeft = null;
        selectedRight = null;
    }

    window.showSetSolution = function(setIdx) {
        const setEl = document.getElementById(`set-${setIdx}`);
        const leftItems = setEl.querySelectorAll('[data-type="left"]');
        const rightItems = setEl.querySelectorAll('[data-type="right"]');

        leftItems.forEach(l => {
            const pairIdx = l.dataset.pair;
            l.className = `match-item matched color-${pairIdx}`;
        });

        rightItems.forEach(r => {
            const pairIdx = r.dataset.pair;
            r.className = `match-item matched color-${pairIdx}`;
        });
        
        selectedLeft = null;
        selectedRight = null;
    }

    renderGames();
</script>

</body>
</html>